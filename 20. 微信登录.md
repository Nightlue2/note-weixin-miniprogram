### 20. 微信登录

完整过程：

![Clip_20220128_093218](D:\0019-pasteEx\PasteEx.v1.1.8.2\PasteEx\User\Temp\Clip_20220128_093218.png)

对于小程序而言，它只需要在login的success回调中进行request，将获取到的code发送到自己的后台服务器，再从后台服务器获取到sessionId进行后续请求即可。

从整个过程来看，小程序如果直接获取到业务Id就会有很大安全隐患，因此微信返回给小程序的是code，第三方服务器返回的也是sessionId，避免了遍历微信用户Id或者业务Id偷取数据的可能性。但这样还会存在问题，比如id泄露，所以要给code和sessionId都增加时效性，防止长时间穷举code或者sessionId的可能性。

让小程序去请求微信服务器，符合UI交互，同时也节省时间成本；而由于第三方服务器更可靠，所以由第三方服务器获取用户ID而非小程序。

用code换取用户ID的行为需要带上appId和appSecret，这两个都是微信端用于鉴别开发者身份的重要信息。后台和微信进行沟通也是通过HTTPS，获取的数据包括微信用户id和会话密钥（session_key），后者可用于在其他接口获取信息，同时这个session_key也不能发送到小程序，它仅仅是为了让开发者服务器在获取ID的时候能够更加快捷。